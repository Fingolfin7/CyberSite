{% extends 'core/base.html'%}
{% load crispy_forms_tags %}
{% load static %}

{% block js_includes %}
    <script src= "https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script> <!-- for jquery ui and autocomplete-->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"> </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!--chart js-->
    <script src="https://cdn.jsdelivr.net/gh/emn178/chartjs-plugin-labels/src/chartjs-plugin-labels.js"></script>
    <script src = "{% static 'core/js/chart.js' %}" type="text/javascript"></script>
    <script src = "{% static 'core/js/issues.js' %}" type="text/javascript"></script>
    <script src = "{% static 'core/js/search.js' %}" type="text/javascript"></script>
    <link rel="stylesheet" href="{% static 'core/css/autocomplete.css' %}">
    <link rel="stylesheet" href="{% static 'core/css/tables.css' %}">
{% endblock %}

{% block popup %}
    <div class="popup" id="issue-popup">
        <div class="popup-content">
          Add Issue from:
          <select class="select-field" name="issue-sources" id="issue-sources">
            <option value="vulns.json">General</option>
            <option value="CWE_V.4.3.json">CWE (Common Weakness Enumeration)</option>
            <option value="OWAS.json">OWASP (Open Web Application Security Project)</option>
            <option value="mobile-attack.json">Mobile</option>
            <option value="enterprise-attack.json">Enterprise</option>
          </select>

          <br>

          <input type="text" class="input-field" data-ajax_url="{% url 'search_vulns' %}" id="issue-title"
           placeholder="Issue Title">
            <div id="autocomplete-cont"></div>

          <button type="button" class="forestgreen button no-border" id="append-issue">
            <i class="material-icons">add</i>
            Add Issue
          </button>

          <button type="button" class="blue-grey button no-border" id="cancel">
            <i class="material-icons">cancel</i>
            Cancel
          </button>
        </div>
    </div>
{% endblock %}

{% block content %}
  <form class="card form"  method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="flex-row">
            <span class="left"><h3><u>Analysis</u></h3></span>
            <span class="flex-row width-20" id="issues-corner-buttons">
                <button type="button" class="blue-grey button no-border" name="stats" id="view_stats">
                    <i class="material-icons">insert_chart</i>
                    Stats
                </button>
                <button type="submit" class="dodgerblue button no-border" name="save">
                    <i class="material-icons">save</i>
                    Save
                </button>
            </span>
        </div>
        <div class='inner-card' id="chart">
            <table>
                <tr class="flex-row">
                    <td class="no-border width-100" id="stats_stuff"></td>
                    <td class="no-border"><canvas id="myChart" ></canvas></td>
                </tr>
            </table>
        </div>
        <div id="issues-div">
          {% for issue in issues %}
            <div class="inner-card">
                <div class="flex-row">
                    <span class="left width-90">
                      {{ issue.name }}
                    </span>
                    <span class="right">
                      <a class="button-link no-border" href="{{issue.id}}">
                        <i class="material-icons">edit</i>
                      </a>
                    </span>
                </div>
            </div>
          {% endfor %}
        </div>
            <button type="button" class="forestgreen button no-border" id="add-issue">
              <i class="material-icons">add</i>
              Add Issue
            </button>
            <a class="button-link no-border blue-grey" href="{% url 'generateReport' issues.0.case.id %}">
              <i class="material-icons">download</i>
              Download Report
            </a>
            <div class="button-row">
              <a href="{% url 'recon' issues.0.case.id %}" class="button-link" id="back">
                <i class="material-icons md-18 no-padding">arrow_back</i>
                Back
              </a>
            </div>
        </div>
  </form>{% endblock %}